<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habitats</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>

    <div class="form-popup" id="myForm">
        <form method="POST" action="/habitats" class="form-container" enctype="multipart/form-data">
            <h1>Create Habitat</h1>

            {{form.title.label}} {{form.title}}
            {{form.description.label}} {{form.description}}
            {{form.icon_image.label}} {{form.icon_image}}
            {{ form.habit.label }} {{ form.habit }}

            <button type="submit" class="btn">Create Habitat</button>

            <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
        </form>
    </div>
    
    <div class="navbar">
        <a href="{{url_for('home1')}}">Home</a>
        <a href="{{url_for('createhabits')}}">My Habits</a>
        <h1>Habit Hero</h1>
        <a href="{{url_for('habitats')}}">Habitats</a>
        <a href="{{url_for('logout')}}">Logout</a>
        <img id="profilePicture" alt="profile picture" src="static/images/profile_default.jpeg">
    </div>
    <main class="container_with_sidebar">
        <div class="sidebar">
            <button class="open-button" onclick="openForm()">Create Habitat</button>

            {% for habitat in habitats %}

            <a class="habitat_item" href="" onclick="selectHabitat(this, '{{habitat.id}}')">
                <img class="habitat_icon" src="{{ url_for('static', filename='images/user_uploads/' + habitat.icon_image) }}">
                <div class="habitat_details">
                    <h3>{{ habitat.title }}</h3>
                    <p>{{ habitat.users_habit }}</p>
                    <!-- <p>{{ habitat.user.habitats|length }} Inhabitants</p> -->
                </div>
            </a>
            
    
            {% endfor %}

            <!-- <div class="habitat_item selected_habitat">
                <img class="habitat_icon" src="static/images/checkmark.png">
                <div class="habitat_details">
                    <h3>Classical Guitar</h3>
                    <p>Practice guitar for 30 minutes</p>
                </div>
            </div>
            <div class="habitat_item">
                <img class="habitat_icon" src="static/images/checkmark.png">
                <div class="habitat_details">
                    <h3>Book Club</h3>
                    <p>Read one chapter</p>
                </div>
            </div> -->
        </div>

        <div class="habitat_view centered">
            <p>No habitat is currently selected</p>
        </div>
    </main>
    <script>
        function selectHabitat(element, habitatId) {
            
            // Prevent the default behavior of the anchor tag
            event.preventDefault();     
            console.log(habitatId)
            // Remove the 'selected_habitat' class from all elements with the same class
            var habitatItems = document.querySelectorAll('.habitat_item');
            habitatItems.forEach(function(item) {
                item.classList.remove('selected_habitat');
            });

            // Add the 'selected_habitat' class to the clicked element
            element.classList.add('selected_habitat');
            showHabitatDetails(habitatId);
        }

        function openForm() {
            document.getElementById("myForm").style.display = "block";
        }

        function closeForm() {
            document.getElementById("myForm").style.display = "none";
        }
        function showHabitatDetails(habitatId) {
            fetch(`/get_habitat_details/${habitatId}`)
                .then(response => response.json())
                .then(data => {
                    updateHabitatView(data);
                })
                .catch(error => console.error('Error fetching habitat details:', error));
        }

        function updateHabitatView(habitatDetails) {
            var habitatView = document.querySelector('.habitat_view');
            var membersHtml = '';

            habitatDetails.members.forEach(member => {
                membersHtml += `
                    <p>${member.name} - Streak: ${member.streak}</p>
                `;
            });

            habitatView.innerHTML = `
                <h2>${habitatDetails.title}</h2>
                <img src="${habitatDetails.icon_image}" alt="${habitatDetails.title}">
                <div class="members-list">
                    ${membersHtml}
                </div>
            `;
        }
    </script>
</body>
</html>

