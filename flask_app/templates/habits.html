<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habits</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
        <div class="navbar">
            <a href="{{url_for('home')}}">Home</a>
            <a href="{{url_for('createhabits')}}">My Habits</a>
            <h1>Habit Hero</h1>
            <a href="{{url_for('habitats')}}">Habitats</a>
            <a href="{{url_for('logout')}}">Logout</a>
            <img id="profilePicture" alt="profile picture" src="static/images/profile_default.jpeg">
        </div>
    <main>

        <!-- <div class="popup" id="popup">
<div class="popup-content">
    <span class="close" id="closePopupButton">&times;</span>
    <h1>Create Habit</h1>

  <form method="POST" id="/habits">
    {{form.title.label}} {{form.title}}
    {{form.submit}}

  </form>
</div> -->

        <button class="open-button" onclick="openForm()">Quick Add Habit</button>
        <button class="open-button" onclick="openFormSlow()">Slow Add Habit</button>
        

        <!-- <label for="email"><b>Habit Name</b></label>
    <input type="text" placeholder="Enter Email" name="email" required>

    <label for="psw"><b>Password</b></label>
    <input type="password" placeholder="Enter Password" name="psw" required> -->
        <!-- The form -->
        <div class="form-popup" id="myForm">
            <form method="POST" action="/habits" class="form-container">
                <h1>Quick Add Habit</h1>

                {{form.title.label}} {{form.title}}

                <button type="submit" class="btn">Quick Add Habit</button>

                <button type="button" class="btn cancel" onclick="closeForm()">Close</button>
            </form>
        </div>

        <div class="form-popup" id="myFormSlow">
            <form method="POST" action="/SlowAdd" class="form-container">
                <h1>Slow Add Habit</h1>

                {{form.title.label}} {{form.title}}
                {{form.description.label}} {{form.description}}

                <button type="submit" class="btn">Slow Add Habit</button>

                <button type="button" class="btn cancel" onclick="closeFormSlow()">Close</button>
            </form>
        </div>

        <div class="form-popup" id="editForm">
            <form method="POST" id="editHabitForm" class="form-container">
                <h1>Edit Habit</h1>
                {{ form.new_title.label }} {{ form.new_title }}
                <button type="button" class="btn" onclick="saveEdit()">Save Edit</button>
                <button type="button" class="btn cancel" onclick="closeEdit()">Cancel</button>
            </form>
        </div>

        <!-- Hardcoded habit for reference -->
        <!-- <div class="habitItem">
            <button><img src="static/images/unchecked.png"></button>
            <p>Drink water</p>
            <div class="spacer"></div>
            <div class="streak">
                <p>10</p>
                <img src="static/images/flame_grayscale.png">
            </div>
        </div>

        <div class="habitItem checkedOff">
            <button><img src="static/images/checkmark.png"></button>
            <p>Drink water</p>
            <div class="spacer"></div>
            <div class="streak">
                <p>10</p>
                <img src="static/images/flame_colored.png">
            </div>
        </div> -->

        {% for habit in habits %}

        <div class="habitItem">
            <button onclick="markAsDone('{{ habit.id }}')">
                {% if habit.done %}
                <img src="static/images/checkmark.png">
                {% else %}
                <img src="static/images/unchecked.png">
                {% endif %}
            </button>

            <p>{{ habit.title }}</p>
            <div class="spacer"></div>
            <div class="streak">
                <p>{{ habit.streak }}</p>

                {% if habit.done %}
                <img src="static/images/flame_colored.png">
                {% else %}
                <img src="static/images/flame_grayscale.png">
                {% endif %}

            </div>

            <button type="submit" class="btn" onclick="removeHabit('{{ habit.id }}')"><img id="delete_habit" src="static/images/remove.png" ></button>
            <button type="submit" class="btn" onclick="editHabit('{{ habit.id }}')"> Edit </button>
        </div>
        {% endfor %}
        {% for habitat in user_habitats %}
            <div class="habitItem">
                <button onclick="markHabitatAsDone('{{ habitat.id }}')">
                    {% if habitat.done %}
                        <img src="static/images/checkmark.png">
                    {% else %}
                        <img src="static/images/unchecked.png">
                    {% endif %}
                </button>
                <!--Shows description for habitat-->
                <p>{{ habitat.description }}</p>

                <div class="spacer"></div>
                <div class="streak">
                    <p>{{ habitat.streak }}</p>
                    {% if habitat.done %}
                        <img src="static/images/flame_colored.png">
                    {% else %}
                        <img src="static/images/flame_grayscale.png">
                    {% endif %}
                </div>
                <button type="submit" class="btn" onclick="removeHabitat('{{ habitat.id }}')"><img id="delete_habit" src="static/images/remove.png" ></button>
            </div>
        {% endfor %} 
                

        

    </main>

    <script>
        function openForm() {
            document.getElementById("myForm").style.display = "block";
        }

        function closeForm() {
            document.getElementById("myForm").style.display = "none";
        }

        function openFormSlow() {
            document.getElementById("myFormSlow").style.display = "block";
        }

        function closeFormSlow() {
            document.getElementById("myFormSlow").style.display = "none";
        }

        function removeHabit(habitId) {
            if (confirm("Are you sure you want to delete this habit?")) {
                fetch(`/habits/${habitId}/delete`, { method: 'POST' })
                    .then(() => location.reload())
                    .catch(error => console.error('Error:', error));
            }
        }

        function removeHabitat(habitatId){
            if (confirm("Are you sure you want to delete this habit?")) {
                fetch(`/habitats/${habitatId}/delete`, { method: 'POST' })
                    .then(() => location.reload())
                    .catch(error => console.error('Error:', error));
            }
        }

        function markAsDone(habitId) {
            fetch(`/habits/${habitId}/update`, { method: 'POST' })
                    .then(() => location.reload())
                    .catch(error => console.error('Error:', error));
        }
        function markHabitatAsDone(habitatId) {
            fetch(`/habitats/${habitatId}/update`, { method: 'POST' })
                    .then(() => location.reload())
                    .catch(error => console.error('Error:', error));
}

        function closeEdit() {
            document.getElementById("editForm").style.display = "none";
        }

        function editHabit(habitId, habitTitle) {
            document.getElementById("editForm").style.display = "block";
            document.getElementById("editHabitForm").setAttribute("data-habit-id", habitId);
            document.querySelector("#editForm input[name='title']").value = habitTitle;
        }

        function saveEdit() {
            const habitId = document.getElementById("editHabitForm").getAttribute("data-habit-id");
            const newTitle = document.querySelector("#editForm input[name='new_title']").value; // Change 'title' to 'new_title'
            const data = { id: habitId, new_title: newTitle }; // Change 'title' to 'new_title'

            fetch(`/habits/${habitId}/edithabits`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeEdit();
                    location.reload();
                } else {
                    // Handle errors, display an error message, etc.
                }
            })
            .catch(error => console.error('Error:', error));
        }

    </script>
</body>

</html>